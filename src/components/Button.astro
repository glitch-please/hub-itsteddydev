---
import { supabase } from "../lib/supabaseClient";
---

<div
  class="max-w-md mx-auto mt-12 p-8 bg-white dark:bg-hub-background-dark rounded-lg shadow-lg"
>
  <h2 id="auth-title" class="text-2xl font-bold mb-6 text-center">Sign In</h2>
  <form id="auth-form" class="flex flex-col gap-4">
    
    
    <input
      name="password"
      type="password"
      placeholder="Password"
      required
      class="input input-bordered w-full px-4 py-2 rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-sky-500"
    />
    <button
      id="auth-submit"
      type="submit"
      class="btn w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 rounded transition"
    >
      Sign In
    </button>
  </form>
  <button
    id="google-btn"
    class="btn w-full mt-4 bg-white border border-gray-300 dark:bg-gray-900 dark:border-gray-700 text-gray-700 dark:text-gray-200 font-semibold py-2 rounded flex items-center justify-center gap-2 transition hover:bg-gray-100 dark:hover:bg-gray-800"
  >
    <svg class="w-5 h-5" viewBox="0 0 48 48"
      ><g
        ><path
          fill="#4285F4"
          d="M24 9.5c3.54 0 6.7 1.22 9.19 3.23l6.85-6.85C36.68 2.36 30.77 0 24 0 14.82 0 6.73 5.1 2.69 12.44l7.98 6.2C12.13 13.13 17.62 9.5 24 9.5z"
        ></path><path
          fill="#34A853"
          d="M46.1 24.55c0-1.64-.15-3.22-.42-4.74H24v9.01h12.42c-.54 2.9-2.18 5.36-4.65 7.03l7.18 5.59C43.98 37.13 46.1 31.36 46.1 24.55z"
        ></path><path
          fill="#FBBC05"
          d="M10.67 28.65c-1.13-3.36-1.13-6.99 0-10.35l-7.98-6.2C.64 16.09 0 19.01 0 22c0 2.99.64 5.91 1.77 8.55l7.98-6.2z"
        ></path><path
          fill="#EA4335"
          d="M24 44c6.48 0 11.92-2.14 15.89-5.82l-7.18-5.59c-2.01 1.35-4.59 2.16-7.71 2.16-6.38 0-11.87-3.63-14.33-8.95l-7.98 6.2C6.73 42.9 14.82 48 24 48z"
        ></path></g
      ></svg
    >
    Sign in with Google
  </button>
  <div class="mt-4 text-center">
    <button
      id="toggle-view"
      class="text-sky-600 hover:underline bg-transparent"
    >
      Don't have an account? Sign up
    </button>
  </div>
  <p id="auth-error" class="mt-4 text-red-600 text-center" style="display:none">
  </p>
</div>

<script type="module">
  // import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
  // const supabase = createClient(
  //   import.meta.env.PUBLIC_SUPABASE_URL,
  //   import.meta.env.PUBLIC_SUPABASE_ANON_KEY
  // );

  const supabaseUrl = "https://qudlxlryegnainztkrtk.supabase.co";
  const supabaseAnonKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1ZGx4bHJ5ZWduYWluenRrcnRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2MzUwMTMsImV4cCI6MjA2ODIxMTAxM30.pAWMWGUCK48Lujssi3Ip4GUm11TZDmaNCINqX3q2m5o";
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabase = createClient(supabaseUrl, supabaseAnonKey);

  let view = "sign_in";
  let loading = false;

  const form = document.getElementById("auth-form");
  const submitBtn = document.getElementById("auth-submit");
  const errorP = document.getElementById("auth-error");
  const toggleBtn = document.getElementById("toggle-view");
  const title = document.getElementById("auth-title");
  const googleBtn = document.getElementById("google-btn");

  function setLoading(state) {
    loading = state;
    submitBtn.disabled = loading;
    googleBtn.disabled = loading;
    submitBtn.textContent = loading
      ? "Loading..."
      : view === "sign_in"
        ? "Sign In"
        : "Sign Up";
    googleBtn.textContent = loading ? "Loading..." : "Sign in with Google";
  }

  function setError(msg) {
    if (msg) {
      errorP.textContent = msg;
      errorP.style.display = "";
    } else {
      errorP.textContent = "";
      errorP.style.display = "none";
    }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    setLoading(true);
    setError("");
    const email = form.email.value;
    const password = form.password.value;
    let result;
    if (view === "sign_in") {
      result = await supabase.auth.signInWithPassword({ email, password });
    } else {
      result = await supabase.auth.signUp({ email, password });
    }
    setLoading(false);
    if (result.error) {
      setError(result.error.message);
    } else {
      window.location.href = "/";
    }
  });

  googleBtn.addEventListener("click", async () => {
    setLoading(true);
    setError("");
    const { error: gError } = await supabase.auth.signInWithOAuth({
      provider: "google",
    });
    setLoading(false);
    if (gError) setError(gError.message);
  });

  toggleBtn.addEventListener("click", () => {
    view = view === "sign_in" ? "sign_up" : "sign_in";
    title.textContent = view === "sign_in" ? "Sign In" : "Create Account";
    submitBtn.textContent = view === "sign_in" ? "Sign In" : "Sign Up";
    toggleBtn.textContent =
      view === "sign_in"
        ? "Don't have an account? Sign up"
        : "Already have an account? Sign in";
    setError("");
  });
</script>
